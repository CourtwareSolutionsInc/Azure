(function(n,t){"use strict";function u(n,t){for(var u,e=[],r=0;r<n.length;++r){if(u=i[n[r]]||f(n[r]),!u)throw"module definition dependecy not found: "+n[r];e.push(u)}t.apply(null,e)}function r(n,r,f){if(typeof n!="string")throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(f===t)throw"invalid module definition, definition function must be specified";u(r,function(){i[n]=f.apply(null,arguments)})}function f(t){for(var r=n,u=t.split(/[.\/]/),i=0;i<u.length;++i){if(!r[u[i]])return;r=r[u[i]]}return r}function e(r){for(var f,o=0;o<r.length;o++){var e=n,s=r[o],u=s.split(/[.\/]/);for(f=0;f<u.length-1;++f)e[u[f]]===t&&(e[u[f]]={}),e=e[u[f]];e[u[u.length-1]]=i[s]}}var i={};r("tinymce/pasteplugin/Clipboard",["tinymce/Env","tinymce/util/Tools","tinymce/util/VK"],function(n,t,i){function r(){return!n.gecko&&("ClipboardEvent"in window||n.webkit&&"FocusEvent"in window)}return function(u){function o(){return(new Date).getTime()}function v(n){return i.metaKeyPressed(n)&&n.keyCode==86||n.shiftKey&&n.keyCode==45}function h(n){return n.innerText||n.textContent}function s(){return o()-a<100||p.pasteFormat=="text"}function y(n,i){return t.each(i,function(t){n=t.constructor==RegExp?n.replace(t,""):n.replace(t[0],t[1])}),n}function f(t){var i=u.fire("PastePreProcess",{content:t});t=i.content,u.settings.paste_data_images||(t=t.replace(/<img src=\"data:image[^>]+>/g,"")),(u.settings.paste_remove_styles||u.settings.paste_remove_styles_if_webkit!==!1&&n.webkit)&&(t=t.replace(/ style=\"[^\"]+\"/g,"")),i.isDefaultPrevented()||u.insertContent(t)}function e(n){var t,i;n=u.dom.encode(n).replace(/\r\n/g,"\n"),t=u.dom.getParent(u.selection.getStart(),u.dom.isBlock),n=t&&/^(PRE|DIV)$/.test(t.nodeName)||!u.settings.forced_root_block?y(n,[[/\n/g,"<br>"]]):y(n,[[/\n\n/g,"<\/p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]]),i=u.fire("PastePreProcess",{content:n}),i.isDefaultPrevented()||u.insertContent(i.content)}function c(){var t=u.dom.getViewPort().y,n=u.dom.add(u.getBody(),"div",{contentEditable:!1,"data-mce-bogus":"1",style:"position: absolute; top: "+t+"px; left: 0; width: 1px; height: 1px; overflow: hidden"},'<div contentEditable="true" data-mce-bogus="1">X<\/div>');return u.dom.bind(n,"beforedeactivate focusin focusout",function(n){n.stopPropagation()}),n}function l(n){u.dom.unbind(n),u.dom.remove(n)}var p=this,a;u.on("keydown",function(n){i.metaKeyPressed(n)&&n.shiftKey&&n.keyCode==86&&(a=o())});if(r())u.on("paste",function(n){function r(n,i){for(var r=0;r<t.types.length;r++)if(t.types[r]==n)return i(t.getData(n)),!0}var t=n.clipboardData,u,i;if(t)if(n.preventDefault(),s())r("text/plain",e)||r("text/html",f);else{u=!1;try{for(i=0;i<t.items.length;i++)if(t.items[i].type=="image/png"){var h=n.clipboardData.items,c=h[i].getAsFile(),o=new FileReader;o.onload=function(n){f('<img src="'+n.target.result+'"/>')},o.readAsDataURL(c),u=!0}else break}catch(n){}u||r("text/html",f)||r("text/plain",e)}});else{if(n.ie)u.on("init",function(){var n=u.dom,t=0;u.on("keydown",function(i){var r,a;v(i)&&!i.isDefaultPrevented()&&(r=c(),t=o(),n.bind(r,"paste",function(){setTimeout(function(){l(r),u.selection.setRng(a),s()?e(h(r.firstChild)):f(r.firstChild.innerHTML)},0)}),a=u.selection.getRng(),r.firstChild.focus(),r.firstChild.innerText="")});u.dom.bind(u.getBody(),"paste",function(i){var v,r,y,a;if(o()-t>100){if(r=c(),i.preventDefault(),n.bind(r,"paste",function(n){n.stopPropagation(),v=!0}),y=u.selection.getRng(),a=n.doc.body.createTextRange(),a.moveToElementText(r.firstChild),a.execCommand("Paste"),l(r),!v){u.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.");return}u.selection.setRng(y),s()?e(h(r.firstChild)):f(r.firstChild.innerHTML)}})});else{u.on("init",function(){u.dom.bind(u.getBody(),"paste",function(n){n.preventDefault(),u.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.")})});u.on("keydown",function(n){if(v(n)&&!n.isDefaultPrevented()){var t=c(),i=u.selection.getRng();u.selection.select(t,!0),u.dom.bind(t,"paste",function(n){n.stopPropagation(),setTimeout(function(){l(t),u.lastRng=i,u.selection.setRng(i);var n=t.firstChild;n.lastChild&&n.lastChild.nodeName=="BR"&&n.removeChild(n.lastChild),s()?e(h(n)):f(n.innerHTML)},0)})}})}if(!u.settings.paste_data_images)u.on("drop",function(n){var t=n.dataTransfer;t&&t.files&&t.files.length>0&&n.preventDefault()})}if(u.paste_block_drop)u.on("dragend dragover draggesture dragdrop drop drag",function(n){n.preventDefault(),n.stopPropagation()});this.paste=f,this.pasteText=e}}),r("tinymce/pasteplugin/WordFilter",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema","tinymce/html/Serializer","tinymce/html/Node"],function(n,t,i,r,u){return function(f){var e=n.each;f.on("PastePreProcess",function(o){function y(n){e(n,function(n){s=n.constructor==RegExp?s.replace(n,""):s.replace(n[0],n[1])})}function p(n){function c(n,i,r,o){var h=n._listLevel||f,s;h!=f&&(h<f?t&&(t=t.parent.parent):(e=t,t=null)),t&&t.name==r?t.append(n):(e=e||t,t=new u(r,1),o>1&&t.attr("start",""+o),n.wrap(t)),n.name="li",i.value="",s=i.next,s&&s.type==3&&(s.value=s.value.replace(/^\u00a0+/,"")),h>f&&e.lastChild.append(t),f=h}for(var t,e,f=1,l=n.getAll("p"),r,i,s,h,o=0;o<l.length;o++)if(n=l[o],n.name=="p"&&n.firstChild){for(r="",i=n.firstChild;i;){if(r=i.value,r)break;i=i.firstChild}if(/^\s*[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*$/.test(r)){c(n,i,"ul");continue}if(/^\s*\w+\./.test(r)){s=/([0-9])\./.exec(r),h=1,s&&(h=parseInt(s[1],10)),c(n,i,"ol",h);continue}t=null}}function w(t,i){var u,r;return(t.name==="p"&&(u=/mso-list:\w+ \w+([0-9]+)/.exec(i),u&&(t._listLevel=parseInt(u[1],10))),f.getParam("paste_retain_style_properties","none")&&(r="",n.each(f.dom.parseStyle(i),function(n,t){switch(t){case"horiz-align":t="text-align";return;case"vert-align":t="vertical-align";return;case"font-color":case"mso-foreground":t="color";return;case"mso-background":case"mso-highlight":t="background"}(h=="all"||c&&c[t])&&(r+=t+":"+n+";")}),r))?r:null}var s=o.content,h,c,l,a,v;(h=f.settings.paste_retain_style_properties,h&&(c=n.makeMap(h)),f.settings.paste_enable_default_filters!==!1)&&/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(o.content)&&(o.wordContent=!0,y([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi," "],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(n,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(" "):""}]]),l=new i({valid_elements:"@[style],-strong/b,-em/i,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,-table,-tr,-td[colspan|rowspan],-th,-thead,-tfoot,-tbody,-a[!href]"}),a=new t({},l),a.addAttributeFilter("style",function(n){for(var i=n.length,t;i--;)t=n[i],t.attr("style",w(t,t.attr("style"))),t.name!="span"||t.attributes.length||t.unwrap()}),v=a.parse(s),p(v),o.content=new r({},l).serialize(v))})}}),r("tinymce/pasteplugin/Quirks",["tinymce/Env","tinymce/util/Tools"],function(n,t){return function(i){function f(n){i.on("PastePreProcess",function(t){t.content=n(t.content)})}function u(n,i){return t.each(i,function(t){n=t.constructor==RegExp?n.replace(t,""):n.replace(t[0],t[1])}),n}function e(n){return u(n,[/^[\s\S]*<!--StartFragment-->|<!--EndFragment-->[\s\S]*$/g,[/<span class="Apple-converted-space">\u00a0<\/span>/g," "],/<br>$/])}function o(n){if(!r){var f=[];t.each(i.schema.getBlockElements(),function(n,t){f.push(t)}),r=new RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+f.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*","g")}return n=u(n,[[r,"$1"]]),u(n,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}var r;n.webkit&&f(e),n.ie&&f(o)}}),r("tinymce/pasteplugin/Plugin",["tinymce/PluginManager","tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks"],function(n,t,i,r){var u;n.add("paste",function(n){var f=this,e;f.clipboard=e=new t(n),f.quirks=new r(n),f.wordFilter=new i(n),n.settings.paste_as_text&&(f.clipboard.pasteFormat="text"),n.addCommand("mceInsertClipboardContent",function(n,t){t.content&&f.clipboard.paste(t.content),t.text&&f.clipboard.pasteText(t.text)}),n.addMenuItem("pastetext",{text:"Paste as text",selectable:!0,active:e.pasteFormat,onclick:function(){e.pasteFormat=="text"?(this.active(!1),e.pasteFormat="html"):(e.pasteFormat="text",this.active(!0),u||(n.windowManager.alert("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off."),u=!0))}})})}),e(["tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks","tinymce/pasteplugin/Plugin"])})(this);
